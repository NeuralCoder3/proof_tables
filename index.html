<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/proof_tables/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="Play with proof tables"/><link rel="apple-touch-icon" href="/proof_tables/logo192.png"/><link rel="manifest" href="/proof_tables/manifest.json"/><link rel="stylesheet" href="/proof_tables/coq-dark.css"/><title>Proof Table</title><title>Interactive Proof Table Tool</title><meta name="title" content="Interactive Proof Table Tool"/><meta name="description" content="Proof your mathematical theorems formally in an interactive way using proof tables."/><meta property="og:type" content="website"/><meta property="og:url" content="/proof_tables/"/><meta property="og:title" content="Interactive Proof Table Tool"/><meta property="og:description" content="Proof your mathematical theorems formally in an interactive way using proof tables."/><meta property="og:image" content="/proof_tables/logo512.png"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="/proof_tables/"/><meta property="twitter:title" content="Interactive Proof Table Tool"/><meta property="twitter:description" content="Proof your mathematical theorems formally in an interactive way using proof tables."/><meta property="twitter:image" content="/proof_tables/logo512.png"/><script defer="defer" src="/proof_tables/static/js/main.fb6d1ea5.js"></script><link href="/proof_tables/static/css/main.026eac6e.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="ide-wrapper" class="toggled" style="display:none"><div id="code-wrapper"><div id="document"><div><textarea id="code1">
          </textarea></div></div></div></div><script type="module">import { JsCoq, FormatPrettyPrint } from '/proof_tables/jscoq_new/jscoq.js';

    const fpp = new FormatPrettyPrint();
    window.fpp = fpp;
    window.module_finished = new Promise(resolve => window.module_finished_resolve = resolve);
    window.module_finished_loading = false;

    var jscoq_ids = ['code1'];

    window.coqdoc_ids = jscoq_ids;

    var jscoq_opts = {
      prelude: true,
      implicit_libs: true,
      editor: { mode: { 'company-coq': true }, keyMap: 'default' },
      theme: 'dark',
      init_pkgs: ['init'],
      all_pkgs: ['coq'],
      debug: false,
      node_modules_path: "/proof_tables/",

      file_dialog: false,
    };

    // see coq-manager goNext
    function addAndExecute(coq, sid, code) {
      // remove comments (* ... *) (can be nested and multiline)
      let code2 = "";
      let i = 0;
      let level = 0;
      while (i < code.length) {
        if (code[i] == '(' && code[i + 1] == '*') {
          level++;
          i += 2;
        } else if (code[i] == '*' && code[i + 1] == ')') {
          level--;
          i += 2;
        } else if (level == 0) {
          code2 += code[i];
          i++;
        } else {
          i++;
        }
      }
      // split into sentences (end with .)
      let sentences = code2.split('.');
      // remove empty sentences
      sentences = sentences.filter(s => s.trim().length > 0);
      sentences = sentences.map(s => s.trim() + '.');
      // add all
      let new_sid = sid;
      for (let i = 0; i < sentences.length; i++) {
        const s = sentences[i];
        coq.add(new_sid, new_sid + 1, s);
        new_sid++;
      }
      // execute last
      coq.exec(new_sid);
      return new_sid;
    }

    async function sleepWait(f) {
      await new Promise(resolve => {
        function run() {
          if (f.isDone()) {
            resolve();
          } else {
            setTimeout(run, 100);
          }
        }
        run();
      });
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    const coq = await JsCoq.start(jscoq_ids, jscoq_opts);

    console.log("JsCoq started", coq, coq.when_ready);
    /** @type {CoqManager} */
    window.coq = coq;

    await coq.when_ready;
    console.log("JsCoq ready");

    /** @type {CoqWorker} */
    const worker = coq.coq;
    window.worker = worker;

    const stm = {
      coq_sid: 2,
      text: "Require Import Init.Prelude Classical Nat PeanoNat.", // Lia
      flags: {},
      sp: {
        mark: (s, m, l) => { },
        highlight: (s, f) => { }
      }
    };
    await coq.add(
      stm,
      1
    );

    // this is needed as unwrapped toplevel promises in this setting are never resolved
    await new Promise(resolve => {
      function run() {
        if (worker.sids[2].isDone()) {
          console.log("worker ready!");
          resolve();
        } else {
          setTimeout(run, 100);
        }
      }
      run();
    });
    const text = await (await fetch("/proof_tables/preload.v")).text();

    const sid = addAndExecute(worker, 2, text);
    window.sid = sid;
    console.log("starting sid:", sid);

    window.module_finished_resolve();
    window.module_finished_loading = true;
    console.log("module finished", window.module_finished);</script><div id="root"></div></body></html>